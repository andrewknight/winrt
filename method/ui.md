# Deeper UI Integration

With a baseline of Qt features functional within the WinRT environment, attention to the more visible details can be focused. This section discusses the user interface integration points available in WinRT and their mappings to the Qt API.

## Platform Menus and Dialogs
QPA, apart from offering acting as lower-level glue between the platform and Qt, also provides some control over higher-level details which affect the look-and-feel. These features remain agnostic to Qt's GUI component offerings (that is, Widgets and Quick) and are mainly used to create native menus and integration points. WinRT includes a few notable examples:
- *Popups*: The [Popups API](/appendix/msdn.md#windows-ui-popups-namespace) is used for displaying message dialogs and context-sensitive menus. While QPA supports some integration support, it does not provide a complete mapping of use cases between WinRT and Qt. For example, Qt supports embedding arbitrary widgets within dialogs and menus, something which is not supported in WinRT. Nonetheless, simple native context menus and message dialogs could easily be supported, particularly when using the [Qt Quick Controls Menu](/appendix/qdoc.md#qt-quick-controls-menu) which settles on a narrower set of capabilities. An experimental [feature was added](/appendix/gerrit.md#54703) to support these native popups.

- *Pickers*: In addition to menus, QPA offers an abstraction for native dialogs - implementers can provide a platform-specific versions of font, color, and file dialogs. WinRT has support for user file selection via its [Windows.Storage.Pickers](/appendix/msdn.md#windows-storage-pickers) interface. Since file system traversal is limited within the appiclation sandbox, a native file dialog is especially important in WinRT. Qt applications can simply create a [QFileDialog](/appendix/qdoc.md#qfiledialog) (or a [QtQuick.Dialogs.FileDialog](/appendix/qdoc.md#qt-quick-dialogs-filedialog)), and the corresponding native FilePicker will be launched.

- *Native menubar*: An interesting feature of some desktop environments is the native menu bar. The native menu bar on Mac OSX, for example, is always visibile but may change its appearance depending on the current application. Qt interfaces with this menu bar, providing entries as if it was a normal menu bar widget. Windows 8 introduces a similar concept known as the "charm bar", an access point to various "[charms](/appendix/msdn.md#charms)", or integration points for tasks like searching and changing settings. To enable access to this feature, the native menu system was integrated with the "Settings" charm, allowing the developer to create menu items using the existing [QMenuBar](/appendix/qdoc.md#qmenubar) widget. The programmer simply enables the `nativeMenuBar` boolean, and menu items appear in the Settings charm instead of a Qt menu bar widget. Unfortunately, integration API is not yet available in Qt Quick Controls.

- *Modern "system tray"*: While Windows 8 has no concept of a system "tray" - or notification area - it does offer [several new UI elements](/appendix/msdn.md#tiles-badges-and-notifications) which cover similar use cases. A notification icon is typically displayed next to the clock on a desktop operating system and conveys status (by e.g. changing the icon) of a running application or service. It may also provide popup messages ("balloons") or have an interactive menu. Qt consolidates these cases into the [QSystemTrayIcon](/appendix/qdoc.md#qsystemtrayicon), which is abstracted in QPA. While there is no tray in the Modern UI, applications can interface with their "tile" (located on the Start screen), their "badge" (an optional component located on the Lock screen), and send popup notifications to the user through "toasts". In order to provide a useful direction for this concept, the following interfaces might be mapped:
- Tray icon: set as the application badge and/or the content of the tile.
- Show a tooltip: this is shown when the user hovers over the tray icon. Tiles support text, so this makes for a natural fit.
- Show a balloon: a balloon with text and an icon appears when the application wants to bring the user's attention to the notification area. This fits in well with the toasts API, which supports both text and images. Since WinRT supports playing a system sound from a predefined set, this sound could potentially be mapped to the criticality argument passed by application.
- Geometry: this allows the platform to inform the application about the size of the tray icon on the screen. In WinRT, the size of the tile is given.
- Activate the icon: the application receives a signal when the tray icon is clicked. This could potentially be implemented from the launcher API if the application is already running and the user taps the tile again. It could alternatively be handled through the toasts API if the user responds to a toast notification.
- Show a menu: a menu can be shown next to the tray icon when it is clicked. There is no equivalent API for this use case in WinRT.

## Platform Look-and-Feel
With no concept of desktop controls in the Modern UI, the Qt widgets can appear a bit out of place here. While [styling them is possible](/appendix/qdoc.md#qstyle), it would be a large undertaking matched with an aging API. Development efforts would be better focused on Qt Quick Controls, the UI library introduced in Qt 5.1, has its own QML-based styling API which should be used on all new platforms. Interestingly, some early experiments with the platform style were already demoed with Qt 4 when the [Metro UI was introduced](/appendix/references.md#29-how-to-create-qt-applications-with-metro-style), suggesting that some of the mindshare required for such a task can already be found within the Qt community.

In order for native styling to be adopted in Qt Quick Controls, the developer should study the native XAML components carefully in order to construct a set of matching controls based on Qt Quick. Making pixel-perfect renderings is difficult in itself, and becomes even more so when considering all animations and behaviors. Undoubtedly, it will take significant investment from the Qt Project should this styling be attempted. This is, after all, the same basic principle that has been applied with existing Qt style plugins on desktop platforms - the difference being that the implementor has the advantage of using Qt Quick and OpenGL instead of the aging QPainter/QStyle API.

## More challenges await
While not a complete port, building Qt applications on WinRT is now a certain possibility. While there is implementation and vision for platform integration, the surface has only been scratched. For integration into the platform look-and-feel, Qt Quick Controls theming will be one of the largest tasks going forward. Even so, it is already possible to build Qt applications for a variety of use cases, and they are no worse off than Qt Quick applications were prior to Qt 5.1.

